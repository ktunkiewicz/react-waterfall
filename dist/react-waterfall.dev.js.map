{"version":3,"file":"react-waterfall.dev.js","sources":["../src/Components/Provider.js","../src/Components/Prevent.js","../src/helpers/connect.js","../src/helpers/subscriptions.js","../src/helpers/devtools.js","../src/index.js"],"sourcesContent":["// @flow\n\nimport React, { Component } from 'react'\n\nimport type { Node } from 'react'\nimport type { CreateProvider, State } from '../types'\n\ntype Props = { children: Node, initialState: {} }\n\nconst EnhancedProvider: CreateProvider = (\n  setProvider,\n  Provider,\n  initialState,\n) =>\n  class EnhancedProvider extends Component<Props, State> {\n    constructor(props) {\n      super()\n      this.state = props.initialState || initialState\n      setProvider(this)\n    }\n\n    render() {\n      return <Provider value={this.state}>{this.props.children}</Provider>\n    }\n  }\n\nexport default EnhancedProvider\n","// @flow\n\nimport { PureComponent } from 'react'\n\nimport type { Node } from 'react'\n\ntype Props = {\n  renderComponent: ({}) => Node,\n}\n\nexport default class Prevent extends PureComponent<Props> {\n  render() {\n    const { renderComponent, ...rest } = this.props\n    return renderComponent(rest)\n  }\n}\n","// @flow\n\nimport * as React from 'react'\nimport Prevent from '../Components/Prevent'\n\nimport type { CreateConnect } from '../types'\n\nconst connect: CreateConnect = Consumer => mapStateToProps =>\n  WrappedComponent => {\n    const renderComponent = props => <WrappedComponent {...props} />\n    const ConnectedComponent = props => (\n      <Consumer>\n        {state => {\n          const filteredState = mapStateToProps(state || {})\n          return (\n            <Prevent\n              renderComponent={renderComponent}\n              {...props}\n              {...filteredState}\n            />\n          )\n        }}\n      </Consumer>\n    )\n\n    ConnectedComponent.displayName = `Connect(${WrappedComponent.displayName ||\n    WrappedComponent.name || 'Unknown'})`\n\n    return ConnectedComponent\n  }\n\nexport default connect\n","// @flow\n\nimport type { Subscription } from '../types'\n\nexport default class Subscriptions {\n  subscriptions = []\n\n  getSubscriptions = () => this.subscriptions\n\n  subscribe = (subscription: Subscription) => {\n    this.subscriptions = [...this.subscriptions, subscription]\n  }\n\n  unsubscribe = (subscription: Subscription) => {\n    this.subscriptions = this.subscriptions\n      .filter(subscriber => subscriber !== subscription)\n  }\n}\n","// @flow\n\nimport type { Middleware } from '../types'\n\nlet id = 0\n\nconst devToolsMiddleware: Middleware = ({ initialState }, self, actions) => {\n  const reduxDevTools = window.devToolsExtension\n\n  const instanceID = id\n  id += 1\n\n  const name = `react-waterfall - ${instanceID}`\n\n  const devTools = reduxDevTools.connect({ name, actionCreators: actions })\n\n  devTools.subscribe(data => {\n    switch (data.type) {\n      case 'START':\n        devTools.init(initialState)\n        break\n      case 'RESET':\n        self.setState(initialState)\n        break\n      case 'DISPATCH':\n        switch (data.payload.type) {\n          case 'JUMP_TO_STATE':\n          case 'JUMP_TO_ACTION': {\n            self.setState(JSON.parse(data.state))\n            break\n          }\n          default:\n            break\n        }\n        break\n      case 'ACTION':\n        // eslint-disable-next-line no-eval\n        eval(data.payload);\n        break;\n      default:\n        break\n    }\n  })\n\n  return (action, ...arg) => {\n    // $FlowFixMe\n    devTools.send({ type: action, ...arg }, self.state, {}, instanceID)\n  }\n}\n\nexport default devToolsMiddleware\n","// @flow\n\nimport { createContext } from 'react'\n\nimport createProvider from './Components/Provider'\nimport createConnect from './helpers/connect'\nimport Subscriptions from './helpers/subscriptions'\nimport devtools from './helpers/devtools'\n\nimport type {\n  CreateStore,\n  ProviderType,\n  SetProvider,\n  CustomSetState,\n  Context,\n} from './types'\n\nconst defaultMiddlewares =\n  process.env.NODE_ENV === 'development' &&\n  typeof window !== 'undefined' &&\n  window.devToolsExtension\n    ? [devtools]\n    : []\n\nconst createStore: CreateStore = (\n  { initialState, actionsCreators = {} },\n  middlewares = [],\n) => {\n  let provider: ProviderType\n  const context: Context = createContext()\n\n  const { getSubscriptions, subscribe, unsubscribe } = new Subscriptions()\n\n  const setProvider: SetProvider = self => {\n    const initializedMiddlewares = [...middlewares, ...defaultMiddlewares]\n      .map(middleware =>\n        middleware({ initialState, actionsCreators }, self, actions))\n\n    provider = {\n      getState: () => self.state,\n      setState: (state, callback) => self.setState(state, callback),\n      initializedMiddlewares,\n    }\n  }\n\n  const setState: CustomSetState = (action, state, ...args) =>\n    new Promise(resolve => {\n      const subscriptions = getSubscriptions()\n      subscriptions.forEach(fn => fn(action, state, ...args))\n      provider.setState(state, () => {\n        provider.initializedMiddlewares.forEach(m => m(action, ...args))\n        resolve()\n      })\n    })\n\n  const actions = Object.keys(actionsCreators).reduce(\n    (r, v) => ({\n      ...r,\n      [v]: (...args) => {\n        if (!provider) {\n          // eslint-disable-next-line no-console\n          console.error('<Provider /> is not initialized yet')\n          return\n        }\n\n        const result = actionsCreators[v](...args)(provider.getState(), actions)\n\n        if (typeof result === 'object') {\n          return result.then\n            ? result.then(res => setState(v, res, ...args))\n            : setState(v, result, ...args)\n        }\n      },\n    }),\n    {},\n  )\n\n  const Provider = createProvider(setProvider, context.Provider, initialState)\n  const connect = createConnect(context.Consumer)\n\n  return {\n    Provider,\n    connect,\n    actions,\n    subscribe,\n    unsubscribe,\n  }\n}\n\nexport default createStore\n"],"names":["EnhancedProvider","setProvider","Provider","initialState","props","state","React","children","Component","Prevent","renderComponent","rest","PureComponent","connect","React.createElement","ConnectedComponent","filteredState","mapStateToProps","displayName","WrappedComponent","name","Subscriptions","subscriptions","subscription","filter","subscriber","id","devToolsMiddleware","self","actions","reduxDevTools","window","devToolsExtension","instanceID","devTools","subscribe","data","type","init","setState","payload","JSON","parse","action","arg","send","defaultMiddlewares","process","devtools","createStore","actionsCreators","middlewares","provider","context","createContext","getSubscriptions","unsubscribe","initializedMiddlewares","map","middleware","callback","args","Promise","forEach","fn","m","Object","keys","reduce","r","v","error","result","getState","then","res","createProvider","createConnect","Consumer"],"mappings":"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"}